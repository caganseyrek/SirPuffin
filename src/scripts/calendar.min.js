import specialdays from"../data/specialdays.json"assert{type:"json"};var savedEvents=localStorage.getItem("savedEvent")?JSON.parse(localStorage.getItem("savedEvent")):[];const titlebarTitle=document.getElementById("title"),calendarElement=document.getElementById("calendar"),calendarTitle=document.getElementById("calendartitle"),weekdayHeaders=document.getElementById("weekdays"),smallCalendarElement=document.getElementById("smallcalendar"),modalBackground=document.getElementById("modalbackground"),modalContainer=document.getElementById("modalcontainer"),modalTitle=document.getElementById("modaltitle"),modalContent=document.getElementById("modalcontent"),weekdaysEnglish=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],weekdaysTurkish=["Pazartesi","Salı","Çarşamba","Perşembe","Cuma","Cumartesi","Pazar"],months=["January","February","March","April","May","June","July","August","September","October","November","December"];var currentMonthCounter=0,currentYearCounter=0,modalState=!1,currentTheme="Light",currentFirstDay="Monday",prevTitlebarTitle="";function renderCalendar(){calendarElement.textContent="",calendarTitle.textContent="",weekdayHeaders.textContent="",smallCalendarElement.textContent="";var e=new Date,t=(0!==currentMonthCounter&&e.setMonth((new Date).getMonth()+currentMonthCounter),0!==currentYearCounter&&((t=(new Date).getFullYear()+currentYearCounter)<1?t=1:9999<t?t=9999:e.setFullYear(t)),e.getMonth()),n=e.getFullYear(),a=e.getDate(),d=(new Date).toLocaleDateString("en-uk",{month:"long"}),l=(new Date).toLocaleDateString("en-uk",{year:"numeric"}),e=new Date(n,t,1),r=new Date(n,t+1,1),o=new Date(n,t,0).getDate(),i=new Date(n,t+1,0).getDate(),t=e.toLocaleDateString("tr-TR",{weekday:"long",year:"numeric",month:"numeric",day:"numeric"});const s=e.toLocaleDateString("en-TR",{month:"long"});var c=r.toLocaleDateString("en-TR",{month:"long"});const m=weekdaysTurkish.indexOf(t.split(" ")[1]);e=document.createElement("b"),e.textContent=s+" ",r=document.createElement("span");r.textContent=n.toString(),calendarTitle.appendChild(e),calendarTitle.appendChild(r),titlebarTitle.textContent=s+" "+n.toString()+" - SirPuffin",document.title=s+" "+n.toString()+" - SirPuffin";for(let e=0;e<=6;e++){var u=document.createElement("div"),u=(u.textContent=weekdaysEnglish[e].slice(0,3),weekdayHeaders.appendChild(u),document.createElement("div"));u.textContent=weekdaysEnglish[e].charAt(0),u.classList.add("scday"),u.classList.add("header"),smallCalendarElement.appendChild(u)}var p=1,C=1;for(let e=1;e<=6;e++){var h=document.createElement("tr");for(let e=1;e<=7;e++){const b=document.createElement("td"),S=document.createElement("div");var v=document.createElement("div"),y=document.createElement("div"),g=(S.classList.add("daylabel"),v.classList.add("dayevent"),y.classList.add("scday"),p<=m?(S.textContent=(o-(m-p)).toString(),b.classList.add("notcurrent"),y.textContent=(o-(m-p)).toString(),y.classList.add("scnotcurrent")):(S.textContent=(p-m).toString(),y.textContent=(p-m).toString(),p-m==1&&(S.textContent=s.slice(0,3)+" "+(p-m)),p-m===a&&d===s&&n.toString()===l&&(S.classList.add("today"),y.classList.add("today"))),p>i+m&&(S.textContent=C.toString(),1===C&&(S.textContent=c.slice(0,3)+" "+C.toString()),b.classList.add("notcurrent"),y.textContent=C.toString(),y.classList.add("scnotcurrent"),C++),b.appendChild(S),!1);const x=document.createElement("div");specialdays.forEach(t=>{var e=(p-m).toString();t.date.split(" ")[1]===s&&t.date.split(" ")[0]===e&&(x.setAttribute("class","specialdayevent"),x.textContent=t.title,x.addEventListener("click",e=>{e.target===x&&openModal("specialDay",null,t)}),b.appendChild(x),g=!0)});var E=!1;savedEvents.forEach(e=>{var t=(p-m).toString();if(e.date.split(" ")[1]===s&&e.date.split(" ")[0]===t){t=document.createElement("div");t.setAttribute("class","dayevent"),g&&t.setAttribute("class","dayevent repositioned"),t.textContent=e.title;const n=[e.title,e.desc];t.addEventListener("click",()=>{openModal("viewDay",e.date,n)}),b.appendChild(t),E=!0}}),E||b.addEventListener("click",e=>{e.target!==x&&openModal("newDayDetails",S.textContent+" "+s,null)}),h.appendChild(b),smallCalendarElement.appendChild(y),p++}calendarElement.appendChild(h)}}function jumpToDate(){var e,t=document.getElementById("jumpyearinput"),n=document.getElementById("jumpmonthdropdown");modalContainer.querySelectorAll("div.errorprompt").forEach(e=>{modalContainer.removeChild(e)}),""===t.value?((e=document.createElement("div")).classList.add("errorprompt"),e.textContent="Invalid date. Please try again.",modalContainer.append(e)):t.value<1||9999<t.value?((e=document.createElement("div")).classList.add("errorprompt"),e.textContent="The year must be between 1-9999. Please try again.",modalContainer.append(e),t.value<1?t.value=1:9999<t&&(t.value=9999)):(e=(new Date).getMonth(),n=months.indexOf(n.value)+1-(e+1),e=(new Date).getFullYear(),t=t.value-e,currentMonthCounter=n,currentYearCounter=t,renderCalendar(),modalState&&closeModal())}function openModal(a,e,t){var n=document.createElement("h2"),d=document.createElement("div");if(d.setAttribute("id","dateselectiongrid"),"settings"===a&&(prevTitlebarTitle=titlebarTitle.textContent,titlebarTitle.textContent="Settings - SirPuffin",n.textContent="Settings",modalTitle.appendChild(n),u=document.createElement("span"),s=document.createElement("span"),u.setAttribute("class","inputlabel"),s.setAttribute("class","inputlabel"),u.textContent="Calendar Theme",s.textContent="First Day of the Week",(h=document.createElement("select")).setAttribute("class","dropdown"),h.setAttribute("id","themeselector"),p=document.createElement("option"),m=document.createElement("option"),p.textContent="Dark",m.textContent="Light",(C=document.createElement("select")).setAttribute("class","dropdown"),C.setAttribute("id","firstdayselector"),c=document.createElement("option"),i=document.createElement("option"),c.textContent="Monday",i.textContent="Sunday",h.appendChild(m),h.appendChild(p),C.appendChild(c),C.appendChild(i),m="Light"===localStorage.getItem("theme")?0:1,p="Monday"===localStorage.getItem("firstday")?0:1,h.selectedIndex=m,C.selectedIndex=p,(c=document.createElement("div")).setAttribute("class","modalrow"),c.appendChild(u),c.appendChild(h),(i=document.createElement("div")).setAttribute("class","modalrow"),i.appendChild(s),i.appendChild(C),(m=document.createElement("a")).setAttribute("id","settingaction"),m.textContent="Save Settings",m.addEventListener("click",()=>{var e=document.getElementById("themeselector").value,t=document.getElementById("firstdayselector").value,n=localStorage.getItem("theme"),a=localStorage.getItem("firstday");e===n&&t===a||(localStorage.setItem("theme",e.toString()),localStorage.setItem("firstday",t.toString()),loadSettings())}),modalContent.appendChild(c),modalContent.appendChild(i),modalContent.appendChild(m)),"specialDay"===a&&(n.textContent=(p=t).title,modalTitle.appendChild(n),u=document.createElement("div"),h=document.createElement("div"),s=document.createElement("div"),(C=document.createElement("div")).setAttribute("class","specialdayinfo"),u.textContent=p.localname,h.textContent=p.date,s.textContent=p.celebratedin,C.textContent=p.extrainfo,prevTitlebarTitle=titlebarTitle.textContent,titlebarTitle.textContent=p.title+" - SirPuffin",c=document.createElement("div"),(i=document.createElement("div")).setAttribute("class","boldtext"),i.textContent="Local Name",c.setAttribute("class","modalrow bordertop"),c.appendChild(i),c.appendChild(u),m=document.createElement("div"),(i=document.createElement("div")).setAttribute("class","boldtext"),i.textContent="Date",m.setAttribute("class","modalrow"),m.appendChild(i),m.appendChild(h),u=document.createElement("div"),(i=document.createElement("div")).setAttribute("class","boldtext"),i.textContent="Celebrated in",u.setAttribute("class","modalrow"),u.appendChild(i),u.appendChild(s),modalContent.appendChild(c),modalContent.appendChild(m),modalContent.appendChild(u),null!==p.extrainfo)&&((h=document.createElement("div")).setAttribute("class","modalrow bordertop extrainfo"),h.appendChild(C),modalContent.appendChild(h)),"jumpToDate"===a){prevTitlebarTitle=titlebarTitle.textContent,titlebarTitle.textContent="Jump to Date - SirPuffin",n.textContent="Jump to Date",modalTitle.appendChild(n);var l=document.createElement("select");l.setAttribute("class","dropdown");for(let e=0;e<12;e++){var r=(new Date).getFullYear(),r=new Date(r,e).toLocaleTimeString("en-uk",{month:"long"}),o=document.createElement("option");o.textContent=r.split(" ")[0],l.appendChild(o)}var i=document.createElement("input"),s=(i.setAttribute("type","number"),i.setAttribute("class","modalinput"),document.createElement("input")),c=(s.setAttribute("type","number"),s.setAttribute("class","modalinput"),s.value=(new Date).getFullYear(),document.createElement("a"));c.setAttribute("id","jumpaction"),c.textContent="Jump!",c.addEventListener("click",()=>{jumpToDate()}),l.setAttribute("id","jumpmonthdropdown"),s.setAttribute("id","jumpyearinput"),d.appendChild(s),d.appendChild(l),d.appendChild(c),modalContent.appendChild(d)}if("viewDay"===a||"newDayDetails"===a){prevTitlebarTitle=titlebarTitle.textContent,titlebarTitle.textContent="viewDay"===a?"Events on "+e+" - SirPuffin":"Add new event on "+e+" - SirPuffin";const v=e+" "+(new Date).getFullYear();n.textContent=e,modalTitle.appendChild(n);var m=document.createElement("div"),u=(m.setAttribute("class","modalrow"),document.createElement("span")),p=(u.setAttribute("class","inputlabel"),u.textContent="Day Title",document.createElement("input")),C=(p.setAttribute("id","daytitleinput"),p.setAttribute("class","modalinput wideinput"),document.createElement("div")),h=(C.setAttribute("class","modalrow"),document.createElement("span")),i=(h.setAttribute("class","boldtext desc"),h.textContent="Day Description",document.createElement("textarea")),s=(i.setAttribute("id","daydescinput"),i.setAttribute("class","modalinput desctext"),"viewDay"===a&&(p.value=t[0],i.value=t[1]),m.appendChild(u),m.appendChild(p),C.appendChild(h),C.appendChild(i),document.createElement("a"));s.setAttribute("id","dayeventaction"),s.textContent="Save Day Details",s.addEventListener("click",()=>{savedEvents=localStorage.getItem("savedEvents")?JSON.parse(localStorage.getItem("savedEvents")):[];var t,e=document.getElementById("daytitleinput").value,n=document.getElementById("daydescinput").value,e=("viewDay"===a&&(t=[],savedEvents.forEach(e=>{e.date!==v&&t.push(e)}),savedEvents=t),{title:e,date:v,desc:n});savedEvents.push(e),localStorage.setItem("savedEvents",JSON.stringify(savedEvents)),renderCalendar(),modalState&&closeModal()}),modalContent.appendChild(m),modalContent.appendChild(C),modalContent.appendChild(s)}modalBackground.style.display="flex",modalState=!0}function closeModal(){titlebarTitle.textContent=prevTitlebarTitle,modalContainer.querySelectorAll("div.errorprompt").forEach(e=>{modalContainer.removeChild(e)}),modalContent.textContent="",modalTitle.textContent="",modalBackground.style.display="none",modalState=!1}function loadSettings(){var e=localStorage.getItem("theme"),t=localStorage.getItem("firstday");null!==e&&null!==t||(localStorage.setItem("theme","Light"),localStorage.setItem("firstday","Monday")),currentTheme!==e&&(document.body.classList.toggle("darkmode"),currentTheme="Light"===currentTheme?"Dark":"Light",localStorage.setItem("theme",currentTheme)),currentFirstDay!==t&&("Sunday"===weekdaysEnglish[0]||"Pazar"===weekdaysTurkish[0]?(e=weekdaysEnglish.reverse().pop(),t=weekdaysTurkish.reverse().pop(),weekdaysEnglish.reverse().push(e),weekdaysTurkish.reverse().push(t)):(e=weekdaysEnglish.pop(),t=weekdaysTurkish.pop(),weekdaysEnglish.unshift(e),weekdaysTurkish.unshift(t)),currentFirstDay="Monday"===currentFirstDay?"Sunday":"Monday",localStorage.setItem("firstday",currentFirstDay)),renderCalendar(),modalState&&closeModal()}function initButtons(){document.getElementById("nextbtn").addEventListener("click",()=>{currentMonthCounter++,renderCalendar()}),document.getElementById("prevbtn").addEventListener("click",()=>{currentMonthCounter--,renderCalendar()}),document.getElementById("todaybtn").addEventListener("click",()=>{currentYearCounter=currentMonthCounter=0,renderCalendar()}),document.getElementById("jumpbtn").addEventListener("click",()=>{openModal("jumpToDate")}),document.getElementById("settingsbtn").addEventListener("click",()=>{openModal("settings")}),document.getElementById("closebtn").addEventListener("click",()=>{closeModal()})}function initShortcuts(){document.addEventListener("keydown",e=>{switch(e.key){case"ArrowLeft":currentMonthCounter--,renderCalendar();break;case"ArrowRight":currentMonthCounter++,renderCalendar()}}),document.addEventListener("keyup",e=>{modalState&&"Escape"===e.key&&closeModal()})}window.onload=()=>{loadSettings(),renderCalendar(),initButtons(),initShortcuts()};
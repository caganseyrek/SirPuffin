import specialdays from"../data/specialdays.json"assert{type:"json"};var savedEvents=localStorage.getItem("savedEvents")?JSON.parse(localStorage.getItem("savedEvents")):[];const titlebarTitle=document.getElementById("title"),calendarElement=document.getElementById("calendar"),calendarTitle=document.getElementById("calendartitle"),weekdayHeaders=document.getElementById("weekdays"),smallCalendarElement=document.getElementById("smallcalendar"),modalBackground=document.getElementById("modalbackground"),modalContainer=document.getElementById("modalcontainer"),modalTitle=document.getElementById("modaltitle"),modalContent=document.getElementById("modalcontent"),weekdaysEnglish=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],weekdaysTurkish=["Pazartesi","Salı","Çarşamba","Perşembe","Cuma","Cumartesi","Pazar"],months=["January","February","March","April","May","June","July","August","September","October","November","December"];var currentMonthCounter=0,currentYearCounter=0,modalState=!1,currentTheme="Light",currentFirstDay="Monday",prevTitlebarTitle="";function renderCalendar(){calendarElement.textContent="",calendarTitle.textContent="",weekdayHeaders.textContent="",smallCalendarElement.textContent="";var e=new Date,t=(0!==currentMonthCounter&&e.setMonth((new Date).getMonth()+currentMonthCounter),0!==currentYearCounter&&((t=(new Date).getFullYear()+currentYearCounter)<1?t=1:9999<t?t=9999:e.setFullYear(t)),e.getMonth());const n=e.getFullYear();var a=e.getDate(),d=(new Date).toLocaleDateString("en-uk",{month:"long"}),l=(new Date).toLocaleDateString("en-uk",{year:"numeric"}),e=new Date(n,t,1),r=new Date(n,t+1,1),o=new Date(n,t,0).getDate(),i=new Date(n,t+1,0).getDate(),t=e.toLocaleDateString("tr-TR",{weekday:"long",year:"numeric",month:"numeric",day:"numeric"});const s=e.toLocaleDateString("en-TR",{month:"long"});var c=r.toLocaleDateString("en-TR",{month:"long"}),m=weekdaysTurkish.indexOf(t.split(" ")[1]),e=document.createElement("b"),r=(e.textContent=s+" ",document.createElement("span"));r.textContent=n.toString(),calendarTitle.appendChild(e),calendarTitle.appendChild(r),titlebarTitle.textContent=s+" "+n.toString()+" - SirPuffin",document.title=s+" "+n.toString()+" - SirPuffin";for(let e=0;e<=6;e++){var u=document.createElement("div"),u=(u.textContent=weekdaysEnglish[e].slice(0,3),weekdayHeaders.appendChild(u),document.createElement("div"));u.textContent=weekdaysEnglish[e].charAt(0),u.classList.add("scday"),u.classList.add("header"),smallCalendarElement.appendChild(u)}var p=1,C=1;for(let e=1;e<=6;e++){var v=document.createElement("tr");for(let e=1;e<=7;e++){const E=document.createElement("td"),b=document.createElement("div");var g=document.createElement("div");if(b.classList.add("daylabel"),g.classList.add("scday"),p<=m?(b.textContent=(o-(m-p)).toString(),E.classList.add("notcurrent"),g.textContent=(o-(m-p)).toString(),g.classList.add("scnotcurrent")):(b.textContent=(p-m).toString(),g.textContent=(p-m).toString(),p-m==1&&(b.textContent=(p-m).toString()),p-m===a&&d===s&&n.toString()===l&&(b.classList.add("today"),g.classList.add("today"))),i+m<p&&(b.textContent=C.toString(),1===C&&(b.textContent=c.slice(0,3)+" "+C.toString()),E.classList.add("notcurrent"),g.textContent=C.toString(),g.classList.add("scnotcurrent"),C++),!E.classList.contains("notcurrent")){const S=(p-m).toString();var h=!1,y=!1;const x=document.createElement("div"),w=document.createElement("div");specialdays.forEach(t=>{t.date.split(" ")[1]===s&&t.date.split(" ")[0]===S&&(x.setAttribute("class","specialdayevent"),x.textContent=t.title,x.addEventListener("click",e=>{e.target===x&&openModal("specialDay",null,t)}),E.appendChild(x),h=!0)}),savedEvents.forEach(e=>{if(e.date.split(" ")[2]===n.toString()&&e.date.split(" ")[1]===s&&e.date.split(" ")[0]===S){w.setAttribute("class","dayevent"),w.textContent=e.title,h&&w.setAttribute("class","dayevent repositioned");const t=[e.title,e.desc];w.addEventListener("click",()=>{openModal("viewDay",e.date,t)}),E.appendChild(w),y=!0}}),y||E.addEventListener("click",e=>{e.target!==x&&openModal("newDayDetails",b.textContent+" "+s,null)})}E.appendChild(b),v.appendChild(E),smallCalendarElement.appendChild(g),p++}calendarElement.appendChild(v)}}function jumpToDate(){var e,t=document.getElementById("jumpyearinput"),n=document.getElementById("jumpmonthdropdown");modalContainer.querySelectorAll("div.errorprompt").forEach(e=>{modalContainer.removeChild(e)}),""===t.value?((e=document.createElement("div")).classList.add("errorprompt"),e.textContent="Invalid date. Please try again.",modalContainer.append(e)):t.value<1||9999<t.value?((e=document.createElement("div")).classList.add("errorprompt"),e.textContent="The year must be between 1-9999. Please try again.",modalContainer.append(e),t.value<1?t.value=1:9999<t&&(t.value=9999)):(e=(new Date).getMonth(),n=months.indexOf(n.value)+1-(e+1),e=(new Date).getFullYear(),t=t.value-e,currentMonthCounter=n,currentYearCounter=t,renderCalendar(),modalState&&closeModal())}function openModal(d,e,t){var l,n,a,r,o,i,s=document.createElement("h2"),c=document.createElement("div");if(c.setAttribute("id","dateselectiongrid"),"settings"===d&&(prevTitlebarTitle=titlebarTitle.textContent,titlebarTitle.textContent="Settings - SirPuffin",s.textContent="Settings",modalTitle.appendChild(s),a=document.createElement("span"),v=document.createElement("span"),a.setAttribute("class","inputlabel"),v.setAttribute("class","inputlabel"),a.textContent="Calendar Theme",v.textContent="First Day of the Week",(i=document.createElement("select")).setAttribute("class","dropdown"),i.setAttribute("id","themeselector"),r=document.createElement("option"),n=document.createElement("option"),r.textContent="Dark",n.textContent="Light",(o=document.createElement("select")).setAttribute("class","dropdown"),o.setAttribute("id","firstdayselector"),g=document.createElement("option"),C=document.createElement("option"),g.textContent="Monday",C.textContent="Sunday",i.appendChild(n),i.appendChild(r),o.appendChild(g),o.appendChild(C),n="Light"===localStorage.getItem("theme")?0:1,r="Monday"===localStorage.getItem("firstday")?0:1,i.selectedIndex=n,o.selectedIndex=r,(g=document.createElement("div")).setAttribute("class","modalrow"),g.appendChild(a),g.appendChild(i),(C=document.createElement("div")).setAttribute("class","modalrow"),C.appendChild(v),C.appendChild(o),(n=document.createElement("a")).setAttribute("id","settingaction"),n.textContent="Save Settings",n.addEventListener("click",()=>{var e=document.getElementById("themeselector").value,t=document.getElementById("firstdayselector").value,n=localStorage.getItem("theme"),a=localStorage.getItem("firstday");e===n&&t===a||(localStorage.setItem("theme",e.toString()),localStorage.setItem("firstday",t.toString()),loadSettings())}),modalContent.appendChild(g),modalContent.appendChild(C),modalContent.appendChild(n)),"specialDay"===d&&(s.textContent=(r=t).title,modalTitle.appendChild(s),a=document.createElement("div"),i=document.createElement("div"),v=document.createElement("div"),(o=document.createElement("div")).setAttribute("class","specialdayinfo"),a.textContent=r.localname,i.textContent=r.date,v.textContent=r.celebratedin,o.textContent=r.extrainfo,prevTitlebarTitle=titlebarTitle.textContent,titlebarTitle.textContent=r.title+" - SirPuffin",g=document.createElement("div"),(C=document.createElement("div")).setAttribute("class","boldtext"),C.textContent="Local Name",g.setAttribute("class","modalrow bordertop"),g.appendChild(C),g.appendChild(a),n=document.createElement("div"),(C=document.createElement("div")).setAttribute("class","boldtext"),C.textContent="Date",n.setAttribute("class","modalrow"),n.appendChild(C),n.appendChild(i),a=document.createElement("div"),(C=document.createElement("div")).setAttribute("class","boldtext"),C.textContent="Celebrated in",a.setAttribute("class","modalrow"),a.appendChild(C),a.appendChild(v),modalContent.appendChild(g),modalContent.appendChild(n),modalContent.appendChild(a),null!==r.extrainfo)&&((i=document.createElement("div")).setAttribute("class","modalrow bordertop extrainfo"),i.appendChild(o),modalContent.appendChild(i)),"jumpToDate"===d){prevTitlebarTitle=titlebarTitle.textContent,titlebarTitle.textContent="Jump to Date - SirPuffin",s.textContent="Jump to Date",modalTitle.appendChild(s);var m=document.createElement("select");m.setAttribute("class","dropdown");for(let e=0;e<12;e++){var u=(new Date).getFullYear(),u=new Date(u,e).toLocaleTimeString("en-uk",{month:"long"}),p=document.createElement("option");p.textContent=u.split(" ")[0],m.appendChild(p)}var C=document.createElement("input"),v=(C.setAttribute("type","number"),C.setAttribute("class","modalinput"),document.createElement("input")),g=(v.setAttribute("type","number"),v.setAttribute("class","modalinput"),v.value=(new Date).getFullYear(),document.createElement("a"));g.setAttribute("id","jumpaction"),g.textContent="Jump!",g.addEventListener("click",()=>{jumpToDate()}),m.setAttribute("id","jumpmonthdropdown"),v.setAttribute("id","jumpyearinput"),c.appendChild(v),c.appendChild(m),c.appendChild(g),modalContent.appendChild(c)}"viewDay"!==d&&"newDayDetails"!==d||(l=2===e.split(" ").length?e+" "+(new Date).getFullYear():e,prevTitlebarTitle=titlebarTitle.textContent,titlebarTitle.textContent="viewDay"===d?"Events on "+e+" - SirPuffin":"Add new event - SirPuffin",s.textContent=l,modalTitle.appendChild(s),(n=document.createElement("div")).setAttribute("class","modalrow"),(a=document.createElement("span")).setAttribute("class","inputlabel"),a.textContent="Day Title",(r=document.createElement("input")).setAttribute("id","daytitleinput"),r.setAttribute("class","modalinput wideinput"),(o=document.createElement("div")).setAttribute("class","modalrow"),(i=document.createElement("span")).setAttribute("class","boldtext desc"),i.textContent="Day Description",(C=document.createElement("textarea")).setAttribute("id","daydescinput"),C.setAttribute("class","modalinput desctext"),"viewDay"===d&&(r.value=t[0],C.value=t[1]),n.appendChild(a),n.appendChild(r),o.appendChild(i),o.appendChild(C),(v=document.createElement("a")).setAttribute("id","dayeventaction"),v.textContent="Save Day Details",v.addEventListener("click",()=>{savedEvents=localStorage.getItem("savedEvents")?JSON.parse(localStorage.getItem("savedEvents")):[];var t,e,n=document.getElementById("daytitleinput").value,a=document.getElementById("daydescinput").value;modalContainer.querySelectorAll("div.errorprompt").forEach(e=>{modalContainer.removeChild(e)}),""===n?((e=document.createElement("div")).classList.add("errorprompt"),e.textContent="Day title cannot be empty. Please try again.",modalContainer.append(e)):("viewDay"===d&&(t=[],savedEvents.forEach(e=>{e.date.toString()!==l&&t.push(e)}),savedEvents=t),e={title:n,date:l,desc:a},savedEvents.push(e),localStorage.setItem("savedEvents",JSON.stringify(savedEvents)),renderCalendar(),modalState&&closeModal())}),(g=document.createElement("a")).setAttribute("id","dayeventaction"),g.setAttribute("class","margintop"),g.textContent="Delete Day Details",g.addEventListener("click",()=>{var t;savedEvents=localStorage.getItem("savedEvents")?JSON.parse(localStorage.getItem("savedEvents")):[],"viewDay"===d&&(t=[],savedEvents.forEach(e=>{e.date.toString()!==l&&t.push(e)}),savedEvents=t),localStorage.setItem("savedEvents",JSON.stringify(savedEvents)),renderCalendar(),modalState&&closeModal()}),modalContent.appendChild(n),modalContent.appendChild(o),modalContent.appendChild(v),"viewDay"===d&&modalContent.appendChild(g)),modalBackground.style.display="flex",modalState=!0}function closeModal(){titlebarTitle.textContent=prevTitlebarTitle,modalContainer.querySelectorAll("div.errorprompt").forEach(e=>{modalContainer.removeChild(e)}),modalContent.textContent="",modalTitle.textContent="",modalBackground.style.display="none",modalState=!1}function loadSettings(){var e=localStorage.getItem("theme"),t=localStorage.getItem("firstday");null!==e&&null!==t||(localStorage.setItem("theme","Light"),localStorage.setItem("firstday","Monday")),currentTheme!==e&&(document.body.classList.toggle("darkmode"),currentTheme="Light"===currentTheme?"Dark":"Light",localStorage.setItem("theme",currentTheme)),currentFirstDay!==t&&("Sunday"===weekdaysEnglish[0]||"Pazar"===weekdaysTurkish[0]?(e=weekdaysEnglish.reverse().pop(),t=weekdaysTurkish.reverse().pop(),weekdaysEnglish.reverse().push(e),weekdaysTurkish.reverse().push(t)):(e=weekdaysEnglish.pop(),t=weekdaysTurkish.pop(),weekdaysEnglish.unshift(e),weekdaysTurkish.unshift(t)),currentFirstDay="Monday"===currentFirstDay?"Sunday":"Monday",localStorage.setItem("firstday",currentFirstDay)),renderCalendar(),modalState&&closeModal()}function initButtons(){document.getElementById("nextbtn").addEventListener("click",()=>{currentMonthCounter++,renderCalendar()}),document.getElementById("prevbtn").addEventListener("click",()=>{currentMonthCounter--,renderCalendar()}),document.getElementById("todaybtn").addEventListener("click",()=>{currentYearCounter=currentMonthCounter=0,renderCalendar()}),document.getElementById("jumpbtn").addEventListener("click",()=>{openModal("jumpToDate")}),document.getElementById("settingsbtn").addEventListener("click",()=>{openModal("settings")}),document.getElementById("closebtn").addEventListener("click",()=>{closeModal()})}function initShortcuts(){document.addEventListener("keydown",e=>{switch(e.key){case"ArrowLeft":currentMonthCounter--,renderCalendar();break;case"ArrowRight":currentMonthCounter++,renderCalendar()}}),document.addEventListener("keyup",e=>{modalState&&"Escape"===e.key&&closeModal()})}window.onload=()=>{loadSettings(),renderCalendar(),initButtons(),initShortcuts()};